# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ: –ì–∏–±–∫–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —á–∞—Ç–æ–≤

## –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å?

–î–æ–±–∞–≤–ª–µ–Ω–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å **–≥–∏–±–∫–æ–π —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏** —Å–ø–∏—Å–∫–∞ —á–∞—Ç–æ–≤ —á–µ—Ä–µ–∑ query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤–º–µ—Å—Ç–æ –∂—ë—Å—Ç–∫–æ –∑–∞–¥–∞–Ω–Ω–æ–π (hardcoded) —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏.

## –ù–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã API

### `GET /api/chats`

–î–æ–±–∞–≤–ª–µ–Ω–æ 2 –Ω–æ–≤—ã—Ö –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–∞:

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –¢–∏–ø | –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|-----|----------------------|----------|
| `sortBy` | string | - | –ü–æ–ª–µ –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏: `lastMessageAt`, `createdAt`, `priority`, `unreadCount`, `ticketNumber`, `status`, `name` |
| `sortOrder` | string | `desc` | –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏: `desc` (—É–±—ã–≤–∞–Ω–∏–µ) –∏–ª–∏ `asc` (–≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏–µ) |

## –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

### –†–µ–∂–∏–º 1: –£–º–Ω–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)

**–ö–æ–≥–¥–∞:** –ø–∞—Ä–∞–º–µ—Ç—Ä `sortBy` **–ù–ï —É–∫–∞–∑–∞–Ω**

**–ü–æ–≤–µ–¥–µ–Ω–∏–µ:** –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞:
1. –ü–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É (desc)
2. –ü–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö (desc)
3. ‚è∞ **–ü–æ –≤—Ä–µ–º–µ–Ω–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è** (desc) - —á–∞—Ç—ã —Å –Ω–µ–¥–∞–≤–Ω–µ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å—é –≤—ã—à–µ

> üí° **–í–∞–∂–Ω–æ:** –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `lastMessageAt` (–≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è), –∞ –ù–ï `createdAt` (–≤—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è —á–∞—Ç–∞). –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –∞–∫—Ç–∏–≤–Ω—ã–µ —á–∞—Ç—ã –≤—Å–µ–≥–¥–∞ –±—É–¥—É—Ç –≤–≤–µ—Ä—Ö—É —Å–ø–∏—Å–∫–∞, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Ç–æ–≥–æ, –∫–æ–≥–¥–∞ –æ–Ω–∏ –±—ã–ª–∏ —Å–æ–∑–¥–∞–Ω—ã.

**–ü—Ä–∏–º–µ—Ä:**
```bash
GET /api/chats
# –∏–ª–∏
GET /api/chats?status=open
```

### –†–µ–∂–∏–º 2: –ö–∞—Å—Ç–æ–º–Ω–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞

**–ö–æ–≥–¥–∞:** –ø–∞—Ä–∞–º–µ—Ç—Ä `sortBy` **—É–∫–∞–∑–∞–Ω**

**–ü–æ–≤–µ–¥–µ–Ω–∏–µ:** –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –æ–¥–Ω–æ–º—É –ø–æ–ª—é —Å —É–∫–∞–∑–∞–Ω–Ω—ã–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º

**–ü—Ä–∏–º–µ—Ä—ã:**
```bash
# ‚è∞ –ü–æ –≤—Ä–µ–º–µ–Ω–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è (—Å–∞–º—ã–µ —Å–≤–µ–∂–∏–µ —á–∞—Ç—ã)
GET /api/chats?sortBy=lastMessageAt&sortOrder=desc

# –ü–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö (—Å–Ω–∞—á–∞–ª–∞ –±–æ–ª—å—à–µ)
GET /api/chats?sortBy=unreadCount&sortOrder=desc

# –ü–æ –¥–∞—Ç–µ —Å–æ–∑–¥–∞–Ω–∏—è —á–∞—Ç–∞ (—Å–Ω–∞—á–∞–ª–∞ —Å—Ç–∞—Ä—ã–µ)
GET /api/chats?sortBy=createdAt&sortOrder=asc

# –ü–æ –∏–º–µ–Ω–∏ (–∞–ª—Ñ–∞–≤–∏—Ç–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ A-Z)
GET /api/chats?sortBy=name&sortOrder=asc

# –ü–æ –Ω–æ–º–µ—Ä—É —Ç–∏–∫–µ—Ç–∞
GET /api/chats?sortBy=ticketNumber&sortOrder=desc
```

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

‚úÖ **Whitelist –≤–∞–ª–∏–¥–∞—Ü–∏—è:** –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω—ã–µ –ø–æ–ª—è –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏  
‚úÖ **–ó–∞—â–∏—Ç–∞ –æ—Ç SQL-–∏–Ω—ä–µ–∫—Ü–∏–π:** –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–µ –ø–æ–ª—è  

### –†–∞–∑—Ä–µ—à—ë–Ω–Ω—ã–µ –ø–æ–ª—è –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏:

| –ü–æ–ª–µ | –û–ø–∏—Å–∞–Ω–∏–µ | –¢–∏–ø –¥–∞–Ω–Ω—ã—Ö |
|------|----------|------------|
| `lastMessageAt` ‚≠ê | –í—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç–µ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) | DateTime |
| `createdAt` | –í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è —á–∞—Ç–∞ | DateTime |
| `priority` | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç —á–∞—Ç–∞ | Enum (urgent/high/normal/low) |
| `unreadCount` | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π | Integer |
| `ticketNumber` | –ù–æ–º–µ—Ä —Ç–∏–∫–µ—Ç–∞ | Integer |
| `status` | –°—Ç–∞—Ç—É—Å —Ç–∏–∫–µ—Ç–∞ | Enum |
| `name` | –ò–º—è –∫–æ–Ω—Ç–∞–∫—Ç–∞ | String |

> ‚è∞ **–†–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É `lastMessageAt` –∏ `createdAt`:**
> - `lastMessageAt` - –∫–æ–≥–¥–∞ –±—ã–ª–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ **–ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ** –≤ —ç—Ç–æ–º —á–∞—Ç–µ (–æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –Ω–æ–≤–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏)
> - `createdAt` - –∫–æ–≥–¥–∞ —á–∞—Ç –±—ã–ª **–≤–ø–µ—Ä–≤—ã–µ —Å–æ–∑–¥–∞–Ω** (–Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è)

## –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã

1. **`src/controllers/chatController.ts`**
   - –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–∞—Ä–∞–º–µ—Ç—Ä—ã `sortBy` –∏ `sortOrder`
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è —á–µ—Ä–µ–∑ whitelist
   - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —É—Å–ª–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏

2. **`CHATS_API_DOCUMENTATION.md`**
   - –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–µ
   - –†–∞—Å—à–∏—Ä–µ–Ω—ã –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
   - –û–±–Ω–æ–≤–ª–µ–Ω—ã React/Vue –ø—Ä–∏–º–µ—Ä—ã —Å UI –¥–ª—è –≤—ã–±–æ—Ä–∞ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### cURL
```bash
# –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏—è–º
curl -X GET "http://localhost:3000/api/chats?sortBy=unreadCount&sortOrder=desc" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### JavaScript/TypeScript
```typescript
const params = new URLSearchParams({
  sortBy: 'unreadCount',
  sortOrder: 'desc',
  status: 'open'
});

const response = await fetch(`/api/chats?${params}`, {
  headers: { 'Authorization': `Bearer ${token}` }
});
```

### React Hook
```typescript
const [sortBy, setSortBy] = useState('');
const [sortOrder, setSortOrder] = useState('desc');

// –í –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ:
<select value={sortBy} onChange={(e) => setSortBy(e.target.value)}>
  <option value="">–£–º–Ω–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)</option>
  <option value="lastMessageAt">–ü–æ –≤—Ä–µ–º–µ–Ω–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è</option>
  <option value="unreadCount">–ü–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö</option>
  <option value="createdAt">–ü–æ –¥–∞—Ç–µ —Å–æ–∑–¥–∞–Ω–∏—è</option>
  <option value="name">–ü–æ –∏–º–µ–Ω–∏</option>
</select>

{sortBy && (
  <select value={sortOrder} onChange={(e) => setSortOrder(e.target.value)}>
    <option value="desc">–ü–æ —É–±—ã–≤–∞–Ω–∏—é ‚Üì</option>
    <option value="asc">–ü–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é ‚Üë</option>
  </select>
)}
```

## –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

‚úÖ **–ü–æ–ª–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:** –í—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã –±–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ `sortBy` –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å —É–º–Ω–æ–π —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–æ–π  
‚úÖ **–ë–µ–∑ breaking changes:** API –æ—Å—Ç–∞—ë—Ç—Å—è –Ω–µ–∏–∑–º–µ–Ω–Ω—ã–º –¥–ª—è —Ç–µ–∫—É—â–∏—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤  

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ

–¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ:
- –°–æ–∑–¥–∞–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è (–≤–∏–¥–∂–µ—Ç—ã) —Å —Ä–∞–∑–ª–∏—á–Ω–æ–π —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–æ–π
- –î–∞–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤—ã–±–∏—Ä–∞—Ç—å —Å–ø–æ—Å–æ–± —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
- –°–æ–∑–¥–∞–≤–∞—Ç—å –∫–∞—Å—Ç–æ–º–Ω—ã–µ –¥–∞—à–±–æ—Ä–¥—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–°–∞–º—ã–µ —Å—Ç–∞—Ä—ã–µ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ")

## –î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

**25 —è–Ω–≤–∞—Ä—è 2025**
