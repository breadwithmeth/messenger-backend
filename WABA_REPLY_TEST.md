# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–ª–∞–µ–≤ –¥–ª—è WABA

**–î–∞—Ç–∞:** 9 —è–Ω–≤–∞—Ä—è 2026  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

## –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

1. ‚úÖ **–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–ø–ª–∞–µ–≤ –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ —Å–æ–æ–±—â–µ–Ω–∏–π** - —Ç–µ–ø–µ—Ä—å —Ä–µ–ø–ª–∞–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–µ —Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π, –Ω–æ –∏ –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π, –≤–∏–¥–µ–æ, –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤, –∞—É–¥–∏–æ –∏ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
2. ‚úÖ **–í–æ–∑–≤—Ä–∞—Ç –¥–∞–Ω–Ω—ã—Ö —Ä–µ–ø–ª–∞—è —á–µ—Ä–µ–∑ API** - –¥–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `quotedContent` –≤ –æ—Ç–≤–µ—Ç—ã API
3. ‚úÖ **–£–ª—É—á—à–µ–Ω–Ω–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞** - –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ü–∏—Ç–∏—Ä—É–µ–º—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ–ø–ª–∞—è –≤ WABA

WABA –ø—Ä–∏—Å—ã–ª–∞–µ—Ç —Ä–µ–ø–ª–∞–∏ –≤ —Å–ª–µ–¥—É—é—â–µ–º —Ñ–æ—Ä–º–∞—Ç–µ:
```json
{
  "context": {
    "from": "77054810862",
    "id": "wamid.HBgLNzcwNTQ4MTA4NjIVAgASGBQzQjc5QUZDNDE5QzdGNDBDNDBCQwA="
  },
  "from": "77054810862",
  "id": "wamid.HBgLNzcwNTQ4MTA4NjIVAgASGBQzQjAyM0FENkU5NzAzM0Q4RTZGQwA=",
  "timestamp": "1767989655",
  "text": {
    "body": "—Ç–µ—Å—Ç2"
  },
  "type": "text"
}
```

**–í–∞–∂–Ω–æ:** 
- `context.id` —Å–æ–¥–µ—Ä–∂–∏—Ç ID —Ü–∏—Ç–∏—Ä—É–µ–º–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
- –¢–µ–∫—Å—Ç —Ü–∏—Ç–∏—Ä—É–µ–º–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –ù–ï –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ webhook
- –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –∏—Å–∫–∞—Ç—å –µ–≥–æ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ `whatsappMessageId = context.id`

## –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- `src/controllers/wabaController.ts` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Ö–æ–¥—è—â–∏—Ö —Ä–µ–ø–ª–∞–µ–≤ –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ —Å–æ–æ–±—â–µ–Ω–∏–π
- `src/controllers/chatController.ts` - –¥–æ–±–∞–≤–ª–µ–Ω `quotedContent` –≤ API –æ—Ç–≤–µ—Ç—ã
- `REPLY_HANDLING.md` - –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

## –ö–∞–∫ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

### 1. –û—Ç–ø—Ä–∞–≤–∫–∞ —Ä–µ–ø–ª–∞—è –Ω–∞ —Ç–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ

1. –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ WABA –Ω–∞ WhatsApp –Ω–æ–º–µ—Ä
2. –í WhatsApp –æ—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ (—Å–≤–∞–π–ø –≤–ø—Ä–∞–≤–æ –∏–ª–∏ –¥–æ–ª–≥–æ–µ –Ω–∞–∂–∞—Ç–∏–µ ‚Üí –û—Ç–≤–µ—Ç–∏—Ç—å)
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ –ª–æ–≥–∞—Ö:
```
[reply] –û—Ç–≤–µ—Ç –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ ID: wamid.xxx, —Ç–µ–∫—Å—Ç: "–û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç"
üì• WABA: –í—Ö–æ–¥—è—â–µ–µ [text]: "–æ—Ç–≤–µ—Ç–∏–ª –Ω–∞: "–û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç"\n\n–û—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"
```

### 2. –û—Ç–ø—Ä–∞–≤–∫–∞ —Ä–µ–ø–ª–∞—è –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ

1. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å –ø–æ–¥–ø–∏—Å—å—é —á–µ—Ä–µ–∑ WABA
2. –í WhatsApp –æ—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ —ç—Ç–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤ –ë–î —Å–æ—Ö—Ä–∞–Ω–∏–ª–æ—Å—å:
```json
{
  "content": "–æ—Ç–≤–µ—Ç–∏–ª –Ω–∞: \"–¢–µ–∫—Å—Ç –ø–æ–¥–ø–∏—Å–∏\"\n\n–û—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è",
  "quotedMessageId": "wamid.xxx",
  "quotedContent": "–¢–µ–∫—Å—Ç –ø–æ–¥–ø–∏—Å–∏"
}
```

–ï—Å–ª–∏ —É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–µ –±—ã–ª–æ –ø–æ–¥–ø–∏—Å–∏:
```json
{
  "quotedContent": "[–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ]"
}
```

### 3. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π —á–µ—Ä–µ–∑ API

–ó–∞–ø—Ä–æ—Å:
```bash
GET /api/chats/:chatId/messages
Authorization: Bearer <token>
```

–û—Ç–≤–µ—Ç –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å:
```json
{
  "messages": [
    {
      "id": 123,
      "content": "–æ—Ç–≤–µ—Ç–∏–ª –Ω–∞: \"–û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ\"\n\n–û—Ç–≤–µ—Ç",
      "quotedMessageId": "wamid.xxx",
      "quotedContent": "–û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ",
      ...
    }
  ]
}
```

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –ø–æ—Å–ª–µ–¥–Ω–µ–º —Å–æ–æ–±—â–µ–Ω–∏–∏ —á–∞—Ç–∞

–ó–∞–ø—Ä–æ—Å:
```bash
GET /api/chats?organizationId=1
Authorization: Bearer <token>
```

–ü–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç–µ –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å `quotedContent`:
```json
{
  "chats": [
    {
      "id": 1,
      "lastMessage": {
        "content": "–æ—Ç–≤–µ—Ç–∏–ª –Ω–∞: \"...\"\n\n...",
        "quotedMessageId": "wamid.xxx",
        "quotedContent": "...",
        ...
      },
      ...
    }
  ]
}
```

## –ü—Ä–∏–º–µ—Ä—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –º–µ–¥–∏–∞

### –†–µ–ø–ª–∞–π –Ω–∞ –≤–∏–¥–µ–æ
```
quotedContent: "–ü–æ–¥–ø–∏—Å—å –∫ –≤–∏–¥–µ–æ" –∏–ª–∏ "[–í–∏–¥–µ–æ]"
content: "–æ—Ç–≤–µ—Ç–∏–ª –Ω–∞: \"–ü–æ–¥–ø–∏—Å—å –∫ –≤–∏–¥–µ–æ\"\n\n–û—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"
```

### –†–µ–ø–ª–∞–π –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç
```
quotedContent: "filename.pdf" –∏–ª–∏ "–ü–æ–¥–ø–∏—Å—å"
content: "–æ—Ç–≤–µ—Ç–∏–ª –Ω–∞: \"[–î–æ–∫—É–º–µ–Ω—Ç: filename.pdf]\"\n\n–û—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"
```

### –†–µ–ø–ª–∞–π –Ω–∞ –∞—É–¥–∏–æ
```
quotedContent: "[–ê—É–¥–∏–æ]"
content: "–æ—Ç–≤–µ—Ç–∏–ª –Ω–∞: \"[–ê—É–¥–∏–æ]\"\n\n–û—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"
```

## –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ü—Ä–æ—Å—Ç–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
–ü—Ä–æ—Å—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–π—Ç–µ `message.content`:
```tsx
<div className="message-text">
  {message.content}
</div>
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
```tsx
function MessageComponent({ message }) {
  const isReply = !!message.quotedContent;
  const mainContent = message.content.replace(/^–æ—Ç–≤–µ—Ç–∏–ª –Ω–∞:.*?\n\n/, '');
  
  return (
    <div className="message">
      {isReply && (
        <div className="quoted-message-block">
          <div className="quoted-indicator">‚Ü©Ô∏è</div>
          <div className="quoted-text">{message.quotedContent}</div>
        </div>
      )}
      <div className="message-content">
        {mainContent}
      </div>
    </div>
  );
}
```

### CSS –ø—Ä–∏–º–µ—Ä
```css
.quoted-message-block {
  background: #f0f0f0;
  border-left: 3px solid #0088cc;
  padding: 8px;
  margin-bottom: 8px;
  border-radius: 4px;
}

.quoted-indicator {
  font-size: 12px;
  color: #0088cc;
  margin-bottom: 4px;
}

.quoted-text {
  font-size: 13px;
  color: #666;
  font-style: italic;
}
```

## –ü—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞: quotedContent –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è
**–†–µ—à–µ–Ω–∏–µ:** –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–ª–µ `quotedContent`. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –±—ç–∫–µ–Ω–¥ –æ–±–Ω–æ–≤–ª–µ–Ω –¥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤–µ—Ä—Å–∏–∏.

### –ü—Ä–æ–±–ª–µ–º–∞: —Ä–µ–ø–ª–∞–∏ —Ä–∞–±–æ—Ç–∞—é—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–µ–∫—Å—Ç–∞
**–†–µ—à–µ–Ω–∏–µ:** –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è `wabaController.ts`, –≥–¥–µ –æ–±—Ä–∞–±–æ—Ç–∫–∞ `context` –≤—ã–Ω–µ—Å–µ–Ω–∞ –ø–µ—Ä–µ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π —Ç–∏–ø–æ–≤ —Å–æ–æ–±—â–µ–Ω–∏–π.

### –ü—Ä–æ–±–ª–µ–º–∞: quotedContent –≤—Å–µ–≥–¥–∞ "[–°–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ]"
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `whatsappMessageId` –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –≤—Ö–æ–¥—è—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏—è—Ö –æ—Ç WABA.

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

- –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: [REPLY_HANDLING.md](./REPLY_HANDLING.md)
- WhatsApp Business API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: https://developers.facebook.com/docs/whatsapp/
