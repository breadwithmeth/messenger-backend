# üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º—ã "–§–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω, –Ω–æ –Ω–µ –≤–∏–¥–µ–Ω –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ"

## ‚úÖ –ü—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞!

### –ü—Ä–∏—á–∏–Ω–∞
–§–∞–π–ª **–ù–ï –∑–∞–≥—Ä—É–∂–∞–ª—Å—è –≤ R2**, –ø–æ—Ç–æ–º—É —á—Ç–æ:
1. ‚ùå –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–∑ `.env` –Ω–µ –∑–∞–≥—Ä—É–∂–∞–ª–∏—Å—å –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
2. ‚ùå `STORAGE_TYPE` –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –±—ã–ª `local`
3. ‚ùå –§–∞–π–ª—ã —Å–æ—Ö—Ä–∞–Ω—è–ª–∏—Å—å –ª–æ–∫–∞–ª—å–Ω–æ –≤ `public/media/`

### –†–µ—à–µ–Ω–∏–µ
‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `dotenv.config()` –≤ –Ω–∞—á–∞–ª–æ `src/app.ts`
‚úÖ –¢–µ–ø–µ—Ä—å –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Å–µ—Ä–≤–µ—Ä–∞ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ `.env`
‚úÖ `STORAGE_TYPE=r2` –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

## üìä –ü—Ä–æ–≤–µ—Ä–∫–∞

### 1. –¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –ø–æ–∫–∞–∑–∞–ª —É—Å–ø–µ—Ö:
```bash
npx ts-node test-r2-upload.ts
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```
‚úÖ [R2] –§–∞–π–ª —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω –≤ R2:
   - Key: media/1764546204082-807765834.txt
   - ETag: "fdb16ccad687f6ea91266f048 7ac9a8b"
   - VersionId: 7e6528d9aaf117fa99edf525800aad64
   - Public URL: https://r2.drawbridge.kz/media/1764546204082-807765834.txt

‚úÖ –§–∞–π–ª –¥–æ—Å—Ç—É–ø–µ–Ω –ø—É–±–ª–∏—á–Ω–æ!
   - Status: 200 OK
   - Content-Type: text/plain
   - –°–æ–¥–µ—Ä–∂–∏–º–æ–µ: Test file created at 2025-11-30T23:43:24.081Z
```

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ Cloudflare Dashboard:
1. –û—Ç–∫—Ä–æ–π—Ç–µ https://dash.cloudflare.com/
2. R2 ‚Üí Bucket `messenger`
3. –ü–∞–ø–∫–∞ `media/`
4. –§–∞–π–ª –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–∏–¥–µ–Ω!

## üöÄ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞

–ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û** –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä:

```bash
npm run build
npm start
```

## üìù –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–¢–µ–ø–µ—Ä—å –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∞–π–ª–æ–≤ –≤—ã –±—É–¥–µ—Ç–µ –≤–∏–¥–µ—Ç—å:

```
üóÑÔ∏è [Storage] –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Storage Service:
   - STORAGE_TYPE: r2
   - R2 Endpoint: https://c83e6cf3f5ad60b7219f4e6ace3873a6.r2.cloudflarestorage.com
   - R2 Bucket: messenger
   - R2 Public URL: https://r2.drawbridge.kz
   - R2 Access Key ID: 0213c9ff...

üì§ [R2] –ù–∞—á–∞–ª–æ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞:
   - Bucket: messenger
   - Key: media/1764546204082-807765834.txt
   - Size: 45 bytes
   - MimeType: text/plain

‚úÖ [R2] –§–∞–π–ª —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω –≤ R2:
   - Key: media/1764546204082-807765834.txt
   - ETag: "fdb16ccad687f6ea91266f048 7ac9a8b"
   - VersionId: 7e6528d9aaf117fa99edf525800aad64
   - Public URL: https://r2.drawbridge.kz/media/1764546204082-807765834.txt
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ñ–æ—Ç–æ –≤ WhatsApp:
1. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ WhatsApp
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞ - –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–ø–∏—Å–∏ `[R2]`
3. –û—Ç–∫—Ä–æ–π—Ç–µ Cloudflare R2 Dashboard
4. –§–∞–π–ª –¥–æ–ª–∂–µ–Ω –ø–æ—è–≤–∏—Ç—å—Å—è –≤ bucket `messenger/media/`
5. URL –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö: `https://r2.drawbridge.kz/media/...`

### –û—Ç–ø—Ä–∞–≤—å—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç –≤ Telegram:
1. –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ñ–∞–π–ª –±–æ—Ç—É
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ - –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–ø–∏—Å–∏ `[R2]`
3. –§–∞–π–ª –ø–æ—è–≤–∏—Ç—Å—è –≤ R2

## ‚ö†Ô∏è –ï—Å–ª–∏ —Ñ–∞–π–ª—ã –≤—Å—ë –µ—â—ë –Ω–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è

### –ü—Ä–æ–≤–µ—Ä–∫–∞ 1: –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```bash
# –í —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:
grep STORAGE_TYPE .env
grep R2_BUCKET_NAME .env
```

**–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:**
```
STORAGE_TYPE=r2
R2_BUCKET_NAME=messenger
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ 2: –°–µ—Ä–≤–µ—Ä –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω?
```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å—Ç–∞—Ä—ã–π –ø—Ä–æ—Ü–µ—Å—Å
pkill -f "node.*server"

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ
npm run build
npm start
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ 3: –õ–æ–≥–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Å–µ—Ä–≤–µ—Ä–∞ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
```
üóÑÔ∏è [Storage] –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Storage Service:
   - STORAGE_TYPE: r2  üëà –í–ê–ñ–ù–û!
```

–ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ `STORAGE_TYPE: local` - –∑–Ω–∞—á–∏—Ç `.env` –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª—Å—è!

## üîß –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –°–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:
```bash
# –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª check-env.ts:
import dotenv from 'dotenv';
dotenv.config();

console.log('üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è:\n');
console.log(`STORAGE_TYPE: ${process.env.STORAGE_TYPE}`);
console.log(`R2_ACCOUNT_ID: ${process.env.R2_ACCOUNT_ID}`);
console.log(`R2_BUCKET_NAME: ${process.env.R2_BUCKET_NAME}`);
console.log(`R2_PUBLIC_URL: ${process.env.R2_PUBLIC_URL}`);
console.log(`R2_ACCESS_KEY_ID: ${process.env.R2_ACCESS_KEY_ID?.substring(0, 8)}...`);

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ:
npx ts-node check-env.ts
```

## üìö –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- ‚úÖ `src/app.ts` - –¥–æ–±–∞–≤–ª–µ–Ω `dotenv.config()`
- ‚úÖ `src/services/storageService.ts` - –¥–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ `test-r2-upload.ts` - —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ R2
- ‚úÖ `.env` - —Å–æ–¥–µ—Ä–∂–∏—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ R2

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
**–î–∞—Ç–∞:** 2025-11-30
