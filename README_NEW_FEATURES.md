# Messenger Backend - –°–∏—Å—Ç–µ–º–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è —á–∞—Ç–æ–≤ –∏ –º–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤

## –ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### üéØ –°–∏—Å—Ç–µ–º–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è —á–∞—Ç–æ–≤ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞–º
- –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ —á–∞—Ç–æ–≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞–º
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–º —á–∞—Ç–æ–≤ (–æ—Ç–∫—Ä—ã—Ç, –∑–∞–∫—Ä—ã—Ç, –≤ –æ–∂–∏–¥–∞–Ω–∏–∏)
- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ —á–∞—Ç–æ–≤ (–Ω–∏–∑–∫–∏–π, –æ–±—ã—á–Ω—ã–π, –≤—ã—Å–æ–∫–∏–π, —Å—Ä–æ—á–Ω—ã–π)
- –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã—Ö/–Ω–µ–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã—Ö —á–∞—Ç–æ–≤

### üì¨ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
- –û—Ç–º–µ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ
- –ü–æ–¥—Å—á–µ—Ç –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ —á–∞—Ç–∞–º
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–æ–≤ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π

### üìé –û—Ç–ø—Ä–∞–≤–∫–∞ –º–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤
- –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π, –≤–∏–¥–µ–æ, –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤, –∞—É–¥–∏–æ
- –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–∏–ø–æ–≤ –∏ —Ä–∞–∑–º–µ—Ä–æ–≤ —Ñ–∞–π–ª–æ–≤
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ URL –∏ –ª–æ–∫–∞–ª—å–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

## –û—Å–Ω–æ–≤–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ —á–∞—Ç–æ–≤
```
POST   /api/chat-assignment/:chatId/assign     - –ù–∞–∑–Ω–∞—á–∏—Ç—å —á–∞—Ç –æ–ø–µ—Ä–∞—Ç–æ—Ä—É
DELETE /api/chat-assignment/:chatId/unassign   - –°–Ω—è—Ç—å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ
GET    /api/chat-assignment/assigned           - –ü–æ–ª—É—á–∏—Ç—å –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–µ —á–∞—Ç—ã
GET    /api/chat-assignment/unassigned         - –ü–æ–ª—É—á–∏—Ç—å –Ω–µ–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–µ —á–∞—Ç—ã
POST   /api/chat-assignment/:chatId/close      - –ó–∞–∫—Ä—ã—Ç—å —á–∞—Ç
```

### –ù–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
```
POST /api/unread/:chatId/mark-read            - –û—Ç–º–µ—Ç–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ
POST /api/unread/:chatId/mark-chat-read       - –û—Ç–º–µ—Ç–∏—Ç—å –≤–µ—Å—å —á–∞—Ç –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–π
GET  /api/unread/counts                       - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö
GET  /api/unread/chats                        - –ß–∞—Ç—ã —Å –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
```

### –ú–µ–¥–∏–∞—Ñ–∞–π–ª—ã
```
POST /api/media/send                          - –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –º–µ–¥–∏–∞—Ñ–∞–π–ª
POST /api/media/upload                        - –ü—Ä–æ—Å—Ç–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –º–µ–¥–∏–∞—Ñ–∞–π–ª
```

### –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
```
GET /api/chats?status=open&assigned=true      - –°–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤ —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π
GET /api/chats/:chatId/messages               - –°–æ–æ–±—â–µ–Ω–∏—è —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ–± –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª–µ
```

## –°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –ù–æ–≤—ã–µ –ø–æ–ª—è –≤ –º–æ–¥–µ–ª–∏ Chat
```prisma
assignedUserId    Int?           // ID –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω–æ–≥–æ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞
assignedUser      User?          // –°–≤—è–∑—å —Å –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–º
assignedAt        DateTime?      // –í—Ä–µ–º—è –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è
status            String         // open, closed, pending
priority          String         // low, normal, high, urgent  
unreadCount       Int            // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
```

### –ù–æ–≤—ã–µ –ø–æ–ª—è –≤ –º–æ–¥–µ–ª–∏ Message
```prisma
isReadByOperator  Boolean        // –ü—Ä–æ—á–∏—Ç–∞–Ω–æ –ª–∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–º
readAt            DateTime?      // –í—Ä–µ–º—è –ø—Ä–æ—á—Ç–µ–Ω–∏—è
senderUserId      Int?           // ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è-–æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è
senderUser        User?          // –°–≤—è–∑—å —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
```

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ —á–∞—Ç–∞ –æ–ø–µ—Ä–∞—Ç–æ—Ä—É
```javascript
const response = await fetch('/api/chat-assignment/1/assign', {
  method: 'POST',
  headers: {
    'Authorization': 'Bearer ' + token,
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    operatorId: 2
  })
});
```

### –û—Ç–ø—Ä–∞–≤–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
```javascript
const formData = new FormData();
formData.append('media', imageFile);
formData.append('organizationPhoneId', '1');
formData.append('receiverJid', '79001234567@s.whatsapp.net');
formData.append('mediaType', 'image');
formData.append('caption', '–û–ø–∏—Å–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è');

const response = await fetch('/api/media/send', {
  method: 'POST',
  headers: {
    'Authorization': 'Bearer ' + token
  },
  body: formData
});
```

### –û—Ç–º–µ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ
```javascript
const response = await fetch('/api/unread/1/mark-read', {
  method: 'POST',
  headers: {
    'Authorization': 'Bearer ' + token,
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    messageIds: [1, 2, 3] // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
  })
});
```

## –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
```bash
npm install
```

2. –°–æ–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç:
```bash
npm run build
```

3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä:
```bash
npm start
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤ –º–µ–¥–∏–∞

–ú–µ–¥–∏–∞—Ñ–∞–π–ª—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ:
```
public/
  media/
    image/      - –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
    video/      - –í–∏–¥–µ–æ—Ñ–∞–π–ª—ã  
    document/   - –î–æ–∫—É–º–µ–Ω—Ç—ã
    audio/      - –ê—É–¥–∏–æ—Ñ–∞–π–ª—ã
```

–î–æ—Å—Ç—É–ø –∫ —Ñ–∞–π–ª–∞–º: `http://server/media/image/filename.jpg`

–ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ñ–∞–π–ª–µ `API_DOCUMENTATION.md`.
