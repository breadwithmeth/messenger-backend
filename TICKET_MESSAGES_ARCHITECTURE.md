# üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ API —Å–æ–æ–±—â–µ–Ω–∏–π —á–µ—Ä–µ–∑ —Ç–∏–∫–µ—Ç—ã

## üìê –ü—Ä–∏–Ω—è—Ç–æ–µ —Ä–µ—à–µ–Ω–∏–µ

### –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏

**–¢–∏–∫–µ—Ç—ã (`/api/tickets`)** - —Ç–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ:
```
GET  /api/tickets/:ticketNumber          ‚Üí –¥–µ—Ç–∞–ª–∏ —Ç–∏–∫–µ—Ç–∞
GET  /api/tickets/:ticketNumber/messages ‚Üí —Å–æ–æ–±—â–µ–Ω–∏—è —Ç–∏–∫–µ—Ç–∞
GET  /api/tickets/:ticketNumber/history  ‚Üí –∏—Å—Ç–æ—Ä–∏—è —Ç–∏–∫–µ—Ç–∞
POST /api/tickets/:ticketNumber/assign   ‚Üí –Ω–∞–∑–Ω–∞—á–∏—Ç—å (–¥–µ–π—Å—Ç–≤–∏–µ –Ω–∞–¥ —Ç–∏–∫–µ—Ç–æ–º)
POST /api/tickets/:ticketNumber/status   ‚Üí –∏–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å (–¥–µ–π—Å—Ç–≤–∏–µ –Ω–∞–¥ —Ç–∏–∫–µ—Ç–æ–º)
```

**–°–æ–æ–±—â–µ–Ω–∏—è (`/api/messages`)** - –æ–ø–µ—Ä–∞—Ü–∏–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏:
```
POST /api/messages/send-text          ‚Üí –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ JID
POST /api/messages/send-media         ‚Üí –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –º–µ–¥–∏–∞
POST /api/messages/send-by-ticket     ‚Üí –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ –Ω–æ–º–µ—Ä—É —Ç–∏–∫–µ—Ç–∞
```

---

## ü§î –ü–æ—á–µ–º—É –Ω–µ POST /api/tickets/:ticketNumber/messages?

### ‚ùå –ü—Ä–æ–±–ª–µ–º—ã —Ç–∞–∫–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞:

1. **–ù–∞—Ä—É—à–µ–Ω–∏–µ RESTful –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤**:
   - `/tickets/:id/messages` –ø–æ–¥—Ä–∞–∑—É–º–µ–≤–∞–µ—Ç –∫–æ–ª–ª–µ–∫—Ü–∏—é —Å–æ–æ–±—â–µ–Ω–∏–π —Ç–∏–∫–µ—Ç–∞
   - POST –≤ –∫–æ–ª–ª–µ–∫—Ü–∏—é –æ–±—ã—á–Ω–æ –æ–∑–Ω–∞—á–∞–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞ –≤ –ë–î
   - –ù–æ –º—ã –Ω–µ —Å–æ–∑–¥–∞–µ–º –∑–∞–ø–∏—Å—å –≤ –ë–î –Ω–∞–ø—Ä—è–º—É—é, –∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —á–µ—Ä–µ–∑ WhatsApp

2. **–°–º–µ—à–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏**:
   - Tickets –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∏–∫–µ—Ç–∞–º–∏
   - Messages –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –æ—Ç–ø—Ä–∞–≤–∫—É —Å–æ–æ–±—â–µ–Ω–∏–π
   - –°–º–µ—à–∏–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏ —É—Å–ª–æ–∂–Ω—è–µ—Ç –∫–æ–¥

3. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**:
   - –ï—Å–ª–∏ –¥–æ–±–∞–≤–∏–º `send-media-by-ticket`, –ø—Ä–∏–¥–µ—Ç—Å—è –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–∏–∫—É
   - –†–∞–∑–Ω—ã–µ —Ç–∏–ø—ã –æ—Ç–ø—Ä–∞–≤–∫–∏ (text, media, template) –±—É–¥—É—Ç –≤ —Ä–∞–∑–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö

### ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞:

1. **–ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ**:
   ```
   Tickets:  —á–∏—Ç–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –æ —Ç–∏–∫–µ—Ç–µ
   Messages: –≤—ã–ø–æ–ª–Ω—è—Ç—å –¥–µ–π—Å—Ç–≤–∏—è —Å —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
   ```

2. **–ï–¥–∏–Ω–æ–æ–±—Ä–∞–∑–∏–µ –æ—Ç–ø—Ä–∞–≤–∫–∏**:
   ```
   /api/messages/send-text         (–ø–æ JID)
   /api/messages/send-media        (–ø–æ JID)
   /api/messages/send-by-ticket    (–ø–æ –Ω–æ–º–µ—Ä—É —Ç–∏–∫–µ—Ç–∞)
   /api/messages/send-template     (–±—É–¥—É—â–µ–µ)
   /api/messages/send-media-by-ticket (–±—É–¥—É—â–µ–µ)
   ```

3. **–õ–µ–≥–∫–æ—Å—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è**:
   - –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ
   - –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã –æ—Ç–ø—Ä–∞–≤–∫–∏
   - –ü—Ä–æ—â–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å

---

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–æ–¥—Ö–æ–¥–æ–≤

### –ü–æ–¥—Ö–æ–¥ 1 (–æ—Ç–∫–ª–æ–Ω–µ–Ω): –í—Å–µ –≤ —Ç–∏–∫–µ—Ç–∞—Ö
```
GET  /api/tickets/299/messages
POST /api/tickets/299/messages     ‚Üê —Å–º–µ—à–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
```

**–ú–∏–Ω—É—Å—ã:**
- Tickets –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä —Å–ª–∏—à–∫–æ–º –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω
- –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏
- –°–ª–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

### –ü–æ–¥—Ö–æ–¥ 2 (–≤—ã–±—Ä–∞–Ω): –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ
```
GET  /api/tickets/299/messages     ‚Üí —á—Ç–µ–Ω–∏–µ (tickets)
POST /api/messages/send-by-ticket  ‚Üí –¥–µ–π—Å—Ç–≤–∏–µ (messages)
```

**–ü–ª—é—Å—ã:**
- –ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
- –ï–¥–∏–Ω–æ–æ–±—Ä–∞–∑–∏–µ API –æ—Ç–ø—Ä–∞–≤–∫–∏
- –õ–µ–≥–∫–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã

**ticketController.ts** (—Ç–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ):
```typescript
export async function getTicketMessages(req, res) {
  // 1. –ù–∞–π—Ç–∏ —á–∞—Ç –ø–æ ticketNumber
  // 2. –í–µ—Ä–Ω—É—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è
}
```

**messageController.ts** (–¥–µ–π—Å—Ç–≤–∏—è):
```typescript
export async function sendTextMessage(req, res) {
  // –û—Ç–ø—Ä–∞–≤–∫–∞ –ø–æ JID
}

export async function sendMessageByTicket(req, res) {
  // 1. –ù–∞–π—Ç–∏ —á–∞—Ç –ø–æ ticketNumber
  // 2. –ò–∑–≤–ª–µ—á—å JID
  // 3. –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Baileys
}
```

### –ú–∞—Ä—à—Ä—É—Ç—ã

**ticketRoutes.ts**:
```typescript
router.get('/:ticketNumber/messages', getTicketMessages);
// POST —É–±—Ä–∞–Ω - –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ messageRoutes
```

**messageRoutes.ts**:
```typescript
router.post('/send-text', sendTextMessage);
router.post('/send-media', sendMediaMessage);
router.post('/send-by-ticket', sendMessageByTicket); // ‚Üê –Ω–æ–≤—ã–π
```

---

## üéØ –ë—É–¥—É—â–∏–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è

### –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å:

```typescript
// messageController.ts
export async function sendMediaByTicket(req, res) {
  const { ticketNumber, mediaType, mediaPath } = req.body;
  // –õ–æ–≥–∏–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –º–µ–¥–∏–∞ –ø–æ –Ω–æ–º–µ—Ä—É —Ç–∏–∫–µ—Ç–∞
}

export async function sendTemplateByTicket(req, res) {
  const { ticketNumber, templateName, params } = req.body;
  // –õ–æ–≥–∏–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —à–∞–±–ª–æ–Ω–∞ –ø–æ –Ω–æ–º–µ—Ä—É —Ç–∏–∫–µ—Ç–∞
}
```

```typescript
// messageRoutes.ts
router.post('/send-media-by-ticket', sendMediaByTicket);
router.post('/send-template-by-ticket', sendTemplateByTicket);
```

**–í—Å—ë –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ!** –ù–µ –Ω—É–∂–Ω–æ –ª–µ–∑—Ç—å –≤ ticketController.

---

## üìö RESTful Guidelines

### –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ REST:

**–†–µ—Å—É—Ä—Å—ã (—Å—É—â–µ—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ):**
- `/api/tickets` - –∫–æ–ª–ª–µ–∫—Ü–∏—è —Ç–∏–∫–µ—Ç–æ–≤
- `/api/tickets/:id` - –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–∏–∫–µ—Ç
- `/api/tickets/:id/messages` - —Å–æ–æ–±—â–µ–Ω–∏—è —Ç–∏–∫–µ—Ç–∞ (–ø–æ–¥—Ä–µ—Å—É—Ä—Å)

**–î–µ–π—Å—Ç–≤–∏—è (–≥–ª–∞–≥–æ–ª—ã):**
- GET - –ø–æ–ª—É—á–∏—Ç—å
- POST - —Å–æ–∑–¥–∞—Ç—å/–≤—ã–ø–æ–ª–Ω–∏—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ
- PUT/PATCH - –æ–±–Ω–æ–≤–∏—Ç—å
- DELETE - —É–¥–∞–ª–∏—Ç—å

### –ù–∞—à–µ —Ä–µ—à–µ–Ω–∏–µ:

```
GET  /api/tickets/:id/messages    ‚Üí —Ä–µ—Å—É—Ä—Å (—á—Ç–µ–Ω–∏–µ)
POST /api/messages/send-by-ticket ‚Üí –¥–µ–π—Å—Ç–≤–∏–µ (–æ—Ç–ø—Ä–∞–≤–∫–∞)
```

–≠—Ç–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç REST –ø—Ä–∏–Ω—Ü–∏–ø–∞–º:
- –¢–∏–∫–µ—Ç - —ç—Ç–æ —Ä–µ—Å—É—Ä—Å –¥–ª—è —á—Ç–µ–Ω–∏—è
- –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è - —ç—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ/–æ–ø–µ—Ä–∞—Ü–∏—è

---

## üí° –í—ã–≤–æ–¥—ã

1. **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –≤–∞–∂–Ω–µ–µ –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏ URL**
   - `POST /api/tickets/299/messages` –∫–æ—Ä–æ—á–µ
   - –ù–æ `POST /api/messages/send-by-ticket` –ø—Ä–∞–≤–∏–ª—å–Ω–µ–µ

2. **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏**
   - –ö–∞–∂–¥—ã–π –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –¥–µ–ª–∞–µ—Ç –æ–¥–Ω–æ –¥–µ–ª–æ —Ö–æ—Ä–æ—à–æ
   - –õ–µ–≥—á–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –∏ —Ä–∞—Å—à–∏—Ä—è—Ç—å

3. **–ï–¥–∏–Ω–æ–æ–±—Ä–∞–∑–∏–µ API**
   - –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ
   - –ü—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ

4. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**
   - –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã –æ—Ç–ø—Ä–∞–≤–∫–∏
   - –ù–µ –Ω—É–∂–Ω–æ –º–µ–Ω—è—Ç—å ticketController

---

**–î–∞—Ç–∞:** 17 –Ω–æ—è–±—Ä—è 2025 –≥.  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞ –∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
