# üö® –ë—ã—Å—Ç—Ä–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ —Å–µ—Å—Å–∏–∏ WhatsApp

## –ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ –æ—à–∏–±–∫—É "bad decrypt"

### –°–∏–º–ø—Ç–æ–º
```
error:1C800064:Provider routines::bad decrypt
resyncing critical_unblock_low from v0
```

### –†–µ—à–µ–Ω–∏–µ (30 —Å–µ–∫—É–Ω–¥)
```bash
# –ó–∞–º–µ–Ω–∏—Ç–µ <–Ω–æ–º–µ—Ä> –Ω–∞ –≤–∞—à –Ω–æ–º–µ—Ä –±–µ–∑ –∑–Ω–∞–∫–∞ +
# –ó–∞–º–µ–Ω–∏—Ç–µ <orgId> –Ω–∞ ID –≤–∞—à–µ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ (–æ–±—ã—á–Ω–æ 1)
node scripts/clean-app-state.js <–Ω–æ–º–µ—Ä> <orgId>

# –ü—Ä–∏–º–µ—Ä:
node scripts/clean-app-state.js 77051234567 1
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç**: –£–¥–∞–ª—è–µ—Ç –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏  
**–ù—É–∂–Ω–æ –ª–∏ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å QR —Å–Ω–æ–≤–∞**: ‚ùå –ù–µ—Ç

---

## –ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ –æ—à–∏–±–∫—É "Bad MAC"

### –°–∏–º–ø—Ç–æ–º
```
Session error:Error: Bad MAC
at Object.verifyMAC
at SessionCipher.doDecryptWhisperMessage
```

### –†–µ—à–µ–Ω–∏–µ

#### –ü–µ—Ä–≤—ã–π —Ä–∞–∑ –≤–∏–¥–∏—Ç–µ –æ—à–∏–±–∫—É?
‚úÖ **–ù–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–π—Ç–µ** - —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—á–∏—Å—Ç–∏—Ç –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–Ω—ã–µ —Å–µ—Å—Å–∏–∏

#### –û—à–∏–±–∫–∞ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è 3+ —Ä–∞–∑–∞?
```bash
# 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—á–µ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫ –≤ –ª–æ–≥–∞—Ö
pm2 logs messenger-backend --lines 100 | grep "Bad MAC error #"

# 2. –ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ "Bad MAC error #3" –∏–ª–∏ –±–æ–ª—å—à–µ - —Å–µ—Å—Å–∏—è –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–∫—Ä—ã—Ç–∞
# –°–∏—Å—Ç–µ–º–∞ —Å–∞–º–∞:
# - –ó–∞–∫—Ä–æ–µ—Ç WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
# - –£–¥–∞–ª–∏—Ç —Å–æ–∫–µ—Ç –∏–∑ –ø–∞–º—è—Ç–∏
# - –û—á–∏—Å—Ç–∏—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏–∑ –ë–î
# - –û–±–Ω–æ–≤–∏—Ç —Å—Ç–∞—Ç—É—Å –Ω–∞ 'logged_out'

# 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å –≤ –ë–î
psql -U postgres -d messenger_db -c "SELECT \"phoneJid\", status FROM \"OrganizationPhone\" WHERE \"phoneJid\" LIKE '77051234567%';"

# 4. –ï—Å–ª–∏ —Å—Ç–∞—Ç—É—Å 'logged_out' - –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ QR
pm2 restart messenger-backend

# 5. –î–æ–∂–¥–∏—Ç–µ—Å—å QR-–∫–æ–¥–∞ –≤ –ª–æ–≥–∞—Ö
pm2 logs messenger-backend --lines 20
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç**: –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –≤—ã—Ö–æ–¥ –∏–∑ —Å–µ—Å—Å–∏–∏  
**–ù—É–∂–Ω–æ –ª–∏ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å QR —Å–Ω–æ–≤–∞**: ‚úÖ –î–∞, –ø–æ—Å–ª–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤—ã—Ö–æ–¥–∞

### –†—É—á–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ (–µ—Å–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∫–∞ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–∞)
```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
psql -U postgres -d messenger_db

# –í—ã–ø–æ–ª–Ω–∏—Ç–µ –æ—á–∏—Å—Ç–∫—É (–∑–∞–º–µ–Ω–∏—Ç–µ –Ω–æ–º–µ—Ä –∏ orgId)
DELETE FROM "BaileysAuth"
WHERE "phoneJid" = '77051234567'
  AND "organizationId" = 1
  AND ("key" LIKE 'session-%' 
    OR "key" LIKE 'pre-key-%' 
    OR "key" LIKE 'sender-key-%');

# –í—ã–π–¥–∏—Ç–µ
\q

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä
pm2 restart messenger-backend
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç**: –£–¥–∞–ª—è–µ—Ç –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–Ω—ã–µ –∫–ª—é—á–∏ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è  
**–ù—É–∂–Ω–æ –ª–∏ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å QR —Å–Ω–æ–≤–∞**: ‚ùå –û–±—ã—á–Ω–æ –Ω–µ—Ç (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –æ—à–∏–±–∫–∞ –ø–æ—Å–ª–µ 5+ —Ä–∞–∑)

---

## –ï—Å–ª–∏ –æ—à–∏–±–∫–∏ –Ω–µ –ø—Ä–µ–∫—Ä–∞—â–∞—é—Ç—Å—è

### –ü–æ–ª–Ω—ã–π —Å–±—Ä–æ—Å (—Ç—Ä–µ–±—É–µ—Ç QR-—Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è)
```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
psql -U postgres -d messenger_db

# –£–¥–∞–ª–∏—Ç–µ –í–°–ï –¥–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
DELETE FROM "BaileysAuth"
WHERE "phoneJid" = '77051234567'
  AND "organizationId" = 1;

# –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç–∞—Ç—É—Å —Ç–µ–ª–µ—Ñ–æ–Ω–∞
UPDATE "OrganizationPhone"
SET status = 'logged_out', "qrCode" = NULL
WHERE "phoneJid" LIKE '77051234567%';

\q

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä
pm2 restart messenger-backend

# –î–æ–∂–¥–∏—Ç–µ—Å—å QR-–∫–æ–¥–∞ –≤ –ª–æ–≥–∞—Ö
pm2 logs messenger-backend
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç**: –ü–æ–ª–Ω–æ—Å—Ç—å—é —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é  
**–ù—É–∂–Ω–æ –ª–∏ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å QR —Å–Ω–æ–≤–∞**: ‚úÖ –î–∞, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
```bash
pm2 logs messenger-backend
```

### –ü–æ—Å–ª–µ–¥–Ω–∏–µ 100 —Å—Ç—Ä–æ–∫ –ª–æ–≥–æ–≤
```bash
pm2 logs messenger-backend --lines 100
```

### –ü–æ–∏—Å–∫ –æ—à–∏–±–æ–∫ –≤ –ª–æ–≥–∞—Ö
```bash
pm2 logs messenger-backend --lines 200 | grep -E "(Bad MAC|bad decrypt|Session error)"
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø–∏—Å–µ–π –≤ –ë–î
```bash
psql -U postgres -d messenger_db -c "SELECT COUNT(*) as total_keys FROM \"BaileysAuth\" WHERE \"phoneJid\" = '77051234567';"
```

---

## ‚ùì FAQ

**Q: –ü–æ—Ç–µ—Ä—è—é –ª–∏ —è —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏?**  
A: –ù–µ—Ç, –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –≤–∞—à–µ–π –ë–î –æ—Ç–¥–µ–ª—å–Ω–æ.

**Q: –ù—É–∂–Ω–æ –ª–∏ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å —Å–µ—Ä–≤–µ—Ä –¥–ª—è –æ—á–∏—Å—Ç–∫–∏?**  
A: –ù–µ—Ç, —Å–∫—Ä–∏–ø—Ç –º–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –Ω–∞ —Ä–∞–±–æ—Ç–∞—é—â–µ–º —Å–µ—Ä–≤–µ—Ä–µ.

**Q: –ö–∞–∫ —á–∞—Å—Ç–æ –Ω—É–∂–Ω–æ –¥–µ–ª–∞—Ç—å –æ—á–∏—Å—Ç–∫—É?**  
A: –û–±—ã—á–Ω–æ –Ω–µ –Ω—É–∂–Ω–æ - —Å–∏—Å—Ç–µ–º–∞ –¥–µ–ª–∞–µ—Ç —ç—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

**Q: –ß—Ç–æ –¥–µ–ª–∞—Ç—å –µ—Å–ª–∏ QR-–∫–æ–¥ –Ω–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è?**  
A: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å –≤ –ë–î –∏ –ª–æ–≥–∏. –í–æ–∑–º–æ–∂–Ω–æ –Ω—É–∂–Ω–æ –≤—Ä—É—á–Ω—É—é —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å 'logged_out'.

---

**üìû –ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å?** –°–º–æ—Ç—Ä–∏—Ç–µ –ø–æ–ª–Ω—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –≤ `BAD_DECRYPT_FIX.md`
