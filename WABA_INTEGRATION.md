# WhatsApp Business API (WABA) Integration

–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ WhatsApp Business API –≤ —Å–∏—Å—Ç–µ–º—É messenger-backend.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Ö–æ–¥—è—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π —á–µ—Ä–µ–∑ webhook
- ‚úÖ –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- ‚úÖ –û—Ç–ø—Ä–∞–≤–∫–∞ —à–∞–±–ª–æ–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (templates)
- ‚úÖ –û—Ç–ø—Ä–∞–≤–∫–∞ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π —Å –∫–Ω–æ–ø–∫–∞–º–∏
- ‚úÖ –û—Ç–ø—Ä–∞–≤–∫–∞ –º–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤ (–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, –¥–æ–∫—É–º–µ–Ω—Ç—ã, –≤–∏–¥–µ–æ, –∞—É–¥–∏–æ)
- ‚úÖ –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ –¥–æ—Å—Ç–∞–≤–∫–∏ (sent, delivered, read)
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –Ω–æ–º–µ—Ä–æ–≤ –≤ –æ–¥–Ω–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
- ‚úÖ –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å Baileys (–Ω–µ–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π API)

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

–í –º–æ–¥–µ–ª—å `OrganizationPhone` –¥–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è –¥–ª—è WABA:

```prisma
model OrganizationPhone {
  // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è
  
  // –¢–∏–ø –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
  connectionType    String  @default("baileys") // "baileys" | "waba"
  
  // WABA –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
  wabaAccessToken   String? // Access Token –æ—Ç Meta
  wabaPhoneNumberId String? // Phone Number ID
  wabaId            String? // WhatsApp Business Account ID
  wabaApiVersion    String? @default("v21.0") // –í–µ—Ä—Å–∏—è API
  wabaVerifyToken   String? // Token –¥–ª—è webhook verification
}
```

### –°–µ—Ä–≤–∏—Å—ã

**`src/services/wabaService.ts`** - –æ—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å WABA API:
- `WABAService` –∫–ª–∞—Å—Å —Å –º–µ—Ç–æ–¥–∞–º–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
- `createWABAService()` - —Ñ–∞–±—Ä–∏–∫–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ —Å–µ—Ä–≤–∏—Å–∞
- `getWABAConfig()` - –ø–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏–∑ –ë–î

**`src/controllers/wabaController.ts`** - –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ webhook –∏ API:
- `verifyWebhook()` - –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è webhook –æ—Ç Meta
- `handleWebhook()` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Ö–æ–¥—è—â–∏—Ö —Å–æ–±—ã—Ç–∏–π
- `sendMessage()` - –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π —á–µ—Ä–µ–∑ API
- `getTemplates()` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —à–∞–±–ª–æ–Ω–æ–≤

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ Meta for Developers

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ https://developers.facebook.com/
2. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (App)
3. –î–æ–±–∞–≤—å—Ç–µ –ø—Ä–æ–¥—É–∫—Ç WhatsApp Business Platform
4. –ü–æ–ª—É—á–∏—Ç–µ:
   - **App ID** –∏ **App Secret**
   - **System User Access Token** (–¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–π)
   - **WhatsApp Business Account ID (WABA ID)**
   - **Phone Number ID**

### 2. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤ –ë–î

–û–±–Ω–æ–≤–∏—Ç–µ –∑–∞–ø–∏—Å—å `OrganizationPhone`:

```sql
UPDATE "OrganizationPhone"
SET 
  "connectionType" = 'waba',
  "wabaAccessToken" = 'YOUR_ACCESS_TOKEN',
  "wabaPhoneNumberId" = 'YOUR_PHONE_NUMBER_ID',
  "wabaId" = 'YOUR_WABA_ID',
  "wabaApiVersion" = 'v21.0',
  "wabaVerifyToken" = 'your_custom_verify_token_12345'
WHERE id = 1;
```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Webhook

1. –í Meta App Dashboard –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ WhatsApp ‚Üí Configuration
2. –£–∫–∞–∂–∏—Ç–µ Webhook URL: `https://your-domain.com/api/waba/webhook`
3. –£–∫–∞–∂–∏—Ç–µ Verify Token (—Ç–∞–∫–æ–π –∂–µ, –∫–∞–∫ `wabaVerifyToken` –≤ –ë–î)
4. –ü–æ–¥–ø–∏—à–∏—Ç–µ—Å—å –Ω–∞ —Å–æ–±—ã—Ç–∏—è:
   - `messages` - –≤—Ö–æ–¥—è—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
   - `message_status` - —Å—Ç–∞—Ç—É—Å—ã –¥–æ—Å—Ç–∞–≤–∫–∏

### 4. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–î–æ–±–∞–≤—å—Ç–µ –≤ `.env`:

```env
# WABA Configuration
WABA_VERIFY_TOKEN=your_custom_verify_token_12345
```

## API Endpoints

### Webhook (–¥–ª—è Meta)

**–í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è webhook**
```
GET /api/waba/webhook
Query params:
  - hub.mode=subscribe
  - hub.verify_token=your_verify_token
  - hub.challenge=random_string
```

**–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π**
```
POST /api/waba/webhook
Body: webhook payload –æ—Ç Meta
```

### –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π

**–¢–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ**
```http
POST /api/waba/send
Authorization: Bearer <token>
Content-Type: application/json

{
  "organizationPhoneId": 1,
  "to": "79001234567",
  "type": "text",
  "message": "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –í–∞—à –∑–∞–∫–∞–∑ –≥–æ—Ç–æ–≤."
}
```

**–®–∞–±–ª–æ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ**
```http
POST /api/waba/send
Authorization: Bearer <token>
Content-Type: application/json

{
  "organizationPhoneId": 1,
  "to": "79001234567",
  "type": "template",
  "message": {
    "name": "order_confirmation",
    "language": "ru",
    "components": [
      {
        "type": "body",
        "parameters": [
          {"type": "text", "text": "12345"}
        ]
      }
    ]
  }
}
```

**–ü–æ–ª—É—á–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–æ–≤**
```http
GET /api/waba/templates?organizationPhoneId=1
Authorization: Bearer <token>
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–¥–µ

### –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è

```typescript
import { createWABAService } from './services/wabaService';

const wabaService = await createWABAService(organizationPhoneId);
if (wabaService) {
  const result = await wabaService.sendTextMessage(
    '79001234567',
    '–ü—Ä–∏–≤–µ—Ç! –≠—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ WABA'
  );
  console.log('Message ID:', result.messages[0].id);
}
```

### –û—Ç–ø—Ä–∞–≤–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

```typescript
await wabaService.sendImage(
  '79001234567',
  'https://example.com/image.jpg',
  '–û–ø–∏—Å–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è'
);
```

### –û—Ç–ø—Ä–∞–≤–∫–∞ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è

```typescript
await wabaService.sendInteractiveMessage(
  '79001234567',
  '–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:',
  [
    { id: 'btn_1', title: '–ó–∞–∫–∞–∑–∞—Ç—å' },
    { id: 'btn_2', title: '–û—Ç–º–µ–Ω–∏—Ç—å' },
    { id: 'btn_3', title: '–°–ø—Ä–∞–≤–∫–∞' }
  ]
);
```

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Ö–æ–¥—è—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π

–í—Ö–æ–¥—è—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
1. –°–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü—É `Message`
2. –ü—Ä–∏–≤—è–∑—ã–≤–∞—é—Ç—Å—è –∫ `Chat` (—Å–æ–∑–¥–∞—ë—Ç—Å—è –µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)
3. –£–≤–µ–ª–∏—á–∏–≤–∞—é—Ç —Å—á—ë—Ç—á–∏–∫ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö `unreadCount`
4. –õ–æ–≥–∏—Ä—É—é—Ç—Å—è —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º `üì• WABA:`

## –¢–∏–ø—ã —Å–æ–æ–±—â–µ–Ω–∏–π

WABA –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ —Ç–∏–ø—ã:

- **text** - –æ–±—ã—á–Ω—ã–π —Ç–µ–∫—Å—Ç
- **image** - –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –ø–æ–¥–ø–∏—Å—å—é
- **document** - –¥–æ–∫—É–º–µ–Ω—Ç (PDF, DOCX, etc.)
- **audio** - –∞—É–¥–∏–æ—Ñ–∞–π–ª
- **video** - –≤–∏–¥–µ–æ —Å –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –ø–æ–¥–ø–∏—Å—å—é
- **template** - –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ –æ–¥–æ–±—Ä–µ–Ω–Ω—ã–π —à–∞–±–ª–æ–Ω
- **interactive** - –∫–Ω–æ–ø–∫–∏ –∏–ª–∏ —Å–ø–∏—Å–∫–∏
- **button** - –æ—Ç–≤–µ—Ç –Ω–∞ –∫–Ω–æ–ø–∫—É
- **location** - –≥–µ–æ–ª–æ–∫–∞—Ü–∏—è
- **contacts** - –∫–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞

## –®–∞–±–ª–æ–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏–π

–°–æ–∑–¥–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–æ–≤:
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ WhatsApp Manager: https://business.facebook.com/latest/whatsapp_manager/message_templates
2. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π —à–∞–±–ª–æ–Ω
3. –î–æ–∂–¥–∏—Ç–µ—Å—å –æ–¥–æ–±—Ä–µ–Ω–∏—è Meta (–æ–±—ã—á–Ω–æ 24-48 —á–∞—Å–æ–≤)
4. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤ API —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º `type: "template"`

–ü—Ä–∏–º–µ—Ä —à–∞–±–ª–æ–Ω–∞:
```
–ù–∞–∑–≤–∞–Ω–∏–µ: order_confirmation
–ö–∞—Ç–µ–≥–æ—Ä–∏—è: UTILITY
–Ø–∑—ã–∫: Russian (ru)
–¢–µ–∫—Å—Ç: –ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –í–∞—à –∑–∞–∫–∞–∑ ‚Ññ{{1}} –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω.
```

## –õ–∏–º–∏—Ç—ã –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

### –¶–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ
- **–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –±–µ—Å–µ–¥—ã**: 1000 –≤ –º–µ—Å—è—Ü
- **–ü–ª–∞—Ç–Ω—ã–µ –±–µ—Å–µ–¥—ã**: –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Å—Ç—Ä–∞–Ω—ã (~$0.0042 –∑–∞ –±–µ—Å–µ–¥—É –≤ –†–æ—Å—Å–∏–∏)
- **–ë–µ—Å–µ–¥–∞** = 24 —á–∞—Å–∞ —Å –º–æ–º–µ–Ω—Ç–∞ –ø–µ—Ä–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è

### –õ–∏–º–∏—Ç—ã –æ—Ç–ø—Ä–∞–≤–∫–∏
- **Tier 1** (–Ω–æ–≤—ã–π): 250 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π/–¥–µ–Ω—å
- **Tier 2**: 1,000 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π/–¥–µ–Ω—å
- **Tier 3**: 10,000 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π/–¥–µ–Ω—å
- **Tier 4**: 100,000 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π/–¥–µ–Ω—å

–ü–æ–≤—ã—à–µ–Ω–∏–µ tier –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Ö–æ—Ä–æ—à–µ–π —Ä–µ–ø—É—Ç–∞—Ü–∏–∏.

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- –®–∞–±–ª–æ–Ω—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ–¥–æ–±—Ä–µ–Ω—ã Meta
- –ù–µ–ª—å–∑—è –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –º–∞—Ä–∫–µ—Ç–∏–Ω–≥ –±–µ–∑ —Å–æ–≥–ª–∞—Å–∏—è
- –ó–∞–ø—Ä–µ—â—ë–Ω —Å–ø–∞–º –∏ –Ω–µ–∂–µ–ª–∞—Ç–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç
- –ö–∞—á–µ—Å—Ç–≤–æ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è –≤–ª–∏—è–µ—Ç –Ω–∞ —Ä–µ–ø—É—Ç–∞—Ü–∏—é

## –û—Ç–ª–∏—á–∏—è –æ—Ç Baileys

| –§—É–Ω–∫—Ü–∏—è | WABA (Official) | Baileys (Unofficial) |
|---------|-----------------|----------------------|
| **–°—Ç–æ–∏–º–æ—Å—Ç—å** | –ü–ª–∞—Ç–Ω–æ (–ø–æ—Å–ª–µ 1000/–º–µ—Å) | –ë–µ—Å–ø–ª–∞—Ç–Ω–æ |
| **–ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å** | –í—ã—Å–æ–∫–∞—è (99.9% uptime) | –°—Ä–µ–¥–Ω—è—è (–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏) |
| **Webhook** | –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π | –≠–º—É–ª—è—Ü–∏—è —á–µ—Ä–µ–∑ polling |
| **–®–∞–±–ª–æ–Ω—ã** | –¢—Ä–µ–±—É—é—Ç –æ–¥–æ–±—Ä–µ–Ω–∏—è | –ù–µ —Ç—Ä–µ–±—É—é—Ç—Å—è |
| **–ú—É–ª—å—Ç–∏—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ** | –î–∞ | –î–∞ |
| **API** | Graph API | WhatsApp Web Protocol |
| **–†–∏—Å–∫ –±–∞–Ω–∞** | –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π | –°—Ä–µ–¥–Ω–∏–π |
| **QR-–∫–æ–¥** | –ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è | –¢—Ä–µ–±—É–µ—Ç—Å—è |

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏

–í—Å–µ —Å–æ–±—ã—Ç–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —Å –ø—Ä–µ—Ñ–∏–∫—Å–∞–º–∏:
- `üì§ WABA:` - –∏—Å—Ö–æ–¥—è—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- `üì• WABA:` - –≤—Ö–æ–¥—è—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- `üìä WABA:` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤
- `‚ùå WABA:` - –æ—à–∏–±–∫–∏
- `‚úÖ WABA:` - —É—Å–ø–µ—à–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- `‚ö†Ô∏è WABA:` - –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è

## –ú–∏–≥—Ä–∞—Ü–∏—è —Å Baileys –Ω–∞ WABA

–î–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏:

1. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –ë–î
2. –û–±–Ω–æ–≤–∏—Ç–µ `connectionType` –Ω–∞ `'waba'`
3. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ WABA credentials
4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ webhook –≤ Meta Dashboard
5. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –æ—Ç–ø—Ä–∞–≤–∫—É/–ø–æ–ª—É—á–µ–Ω–∏–µ
6. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Baileys —Å–µ—Å—Å–∏—é –¥–ª—è —ç—Ç–æ–≥–æ –Ω–æ–º–µ—Ä–∞

```sql
-- –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ WABA
UPDATE "OrganizationPhone"
SET "connectionType" = 'waba',
    "wabaAccessToken" = 'EAA...',
    "wabaPhoneNumberId" = '123...',
    "wabaId" = '456...'
WHERE id = 1;
```

## Troubleshooting

### Webhook –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ URL –¥–æ—Å—Ç—É–ø–µ–Ω –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ ngrok –¥–ª—è dev)
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ–¥–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–Ω–∞ –≤ Meta Dashboard
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞ –æ—à–∏–±–∫–∏
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `wabaVerifyToken` —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏

### –û—à–∏–±–∫–∞ 401 Unauthorized
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `wabaAccessToken` –∞–∫—Ç—É–∞–ª–µ–Ω
- System User token –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ WABA

### –°–æ–æ–±—â–µ–Ω–∏—è –Ω–µ –¥–æ—Å—Ç–∞–≤–ª—è—é—Ç—Å—è
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ (–±–µ–∑ +)
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞—á–∞–ª –¥–∏–∞–ª–æ–≥ –ø–µ—Ä–≤—ã–º
- –î–ª—è –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ –æ–¥–æ–±—Ä–µ–Ω–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã

### –í—Ö–æ–¥—è—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –¥—É–±–ª–∏—Ä—É—é—Ç—Å—è
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ webhook endpoint –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–µ–Ω
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–µ—Ç –ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–æ–¥–ø–∏—Å–æ–∫ –≤ Meta Dashboard

## –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [WhatsApp Business Platform Docs](https://developers.facebook.com/docs/whatsapp)
- [Cloud API Reference](https://developers.facebook.com/docs/whatsapp/cloud-api)
- [Message Templates](https://developers.facebook.com/docs/whatsapp/message-templates)
- [Webhook Reference](https://developers.facebook.com/docs/whatsapp/cloud-api/webhooks)
- [Meta Business Suite](https://business.facebook.com/)
- [Pricing](https://developers.facebook.com/docs/whatsapp/pricing)

## –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è

**2025-12-09** - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è WABA –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ –ø—Ä–æ–µ–∫—Ç
